{# JS-Twig template for Meilisearch/Algolia "hit" with shape:
   { id, title, overview, director, actors[], characters[], year, votes, rating, popularity, budget, posterUrl, _highlightResult? }

   Searchable text fields (highlighted if present):
   - title
   - overview
   - director
   - actors (first 3 shown)
   - characters (first 3 shown; only shown if actors not present or to supplement)

   Notes:
   - Uses Bootstrap 5 only (Tabler/core-friendly).
   - Uses ux_icon() only where already used in your code (JSON button).
#}

<div class="card h-100">
    <div class="row g-0">
        {% if hit.posterUrl %}
            <div class="col-auto">
                <img
                    src="{{ hit.posterUrl }}"
                    alt="{{ (hit.title ?? '') }}"
                    class="img-fluid rounded-start"
                    style="width:154px;height:auto"
                    loading="lazy"
                >
            </div>
        {% endif %}

        <div class="col">
            <div class="card-header d-flex align-items-start justify-content-between gap-3">
                <div class="flex-grow-1 min-w-0">
                    <h5 class="mb-1 text-truncate">
                        {% if hit._highlightResult and hit._highlightResult.title and hit._highlightResult.title.value %}
                            {{ hit._highlightResult.title.value|raw }}
                        {% else %}
                            {{ hit.title }}
                        {% endif %}
                    </h5>

                    {% if hit.year %}
                        <div class="text-body-secondary small d-flex align-items-center gap-2">
                            {# calendar icon (inline SVG, safe everywhere) #}
                            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true">
                                <path fill="currentColor" d="M7 2v2H5a2 2 0 0 0-2 2v2h18V6a2 2 0 0 0-2-2h-2V2h-2v2H9V2zM3 10v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V10zm4 3h4v4H7z"/>
                            </svg>
                            <span>{{ hit.year }}</span>
                        </div>
                    {% endif %}
                </div>

                {% if hit.rating is defined and hit.rating is not null %}
                    <span class="badge text-bg-warning d-inline-flex align-items-center gap-1 fs-6">
            {# star icon #}
            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" aria-hidden="true">
              <path fill="currentColor" d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327l4.898.696c.441.062.612.636.282.95l-3.522 3.356l.83 4.73c.078.443-.36.79-.746.592L8 13.187z"/>
            </svg>
            <span>{{ hit.rating }}/10</span>
          </span>
                {% endif %}
            </div>

            <div class="card-body">
                {% if hit.overview %}
                    <p class="text-body-secondary mb-3" style="-webkit-line-clamp:3;display:-webkit-box;-webkit-box-orient:vertical;overflow:hidden;">
                        {% if hit._highlightResult and hit._highlightResult.overview and hit._highlightResult.overview.value %}
                            {{ hit._highlightResult.overview.value|raw }}
                        {% else %}
                            {{ hit.overview }}
                        {% endif %}
                    </p>
                {% endif %}

                <div class="mb-3">
                    {# Director #}
                    {% if hit.director %}
                        <div class="d-flex gap-2 align-items-start mb-2">
                            {# person icon #}
                            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true">
                                <path fill="currentColor" d="M12 12a5 5 0 1 0-5-5a5 5 0 0 0 5 5m0 2c-4.42 0-8 2.24-8 5v1h16v-1c0-2.76-3.58-5-8-5"/>
                            </svg>
                            <div>
                                <div class="fw-semibold">Director</div>
                                <div>
                                    {% if hit._highlightResult and hit._highlightResult.director and hit._highlightResult.director.value %}
                                        {{ hit._highlightResult.director.value|raw }}
                                    {% else %}
                                        {{ hit.director }}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    {# Cast (actors) â€” show first 3, highlight where possible #}
                    {% set showActors = (hit.actors is defined and hit.actors|length > 0) %}
                    {% if showActors %}
                        <div class="d-flex gap-2 align-items-start mb-1">
                            {# users icon #}
                            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true">
                                <path fill="currentColor" d="M16 11a3 3 0 1 0-3-3a3 3 0 0 0 3 3m-8 0a3 3 0 1 0-3-3a3 3 0 0 0 3 3m0 2c-2.67 0-8 1.34-8 4v2h10v-2c0-1.53.81-2.86 2.03-3.78A9.1 9.1 0 0 0 8 13m8 0c-.86 0-1.66.11-2.4.3A5.01 5.01 0 0 1 18 18v2h6v-2c0-2.66-5.33-4-8-4"/>
                            </svg>
                            <div class="flex-grow-1">
                                <div class="fw-semibold">Cast</div>
                                <div class="text-truncate">
                                    {% set actorsToShow = hit.actors|slice(0,3) %}
                                    {% for i, actor in actorsToShow %}
                                        {% set hr = hit._highlightResult and hit._highlightResult.actors is defined ? hit._highlightResult.actors[i] : null %}
                                        {% if hr and hr.value is defined %}
                                            {{ hr.value|raw }}{% if not loop.last %}, {% endif %}
                                        {% else %}
                                            {{ actor }}{% if not loop.last %}, {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                    {% if hit.actors|length > 3 %}
                                        <span class="text-body-secondary">+{{ hit.actors|length - 3 }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    {# Characters (optional): show first 3 if present; highlight where possible #}
                    {% if hit.characters is defined and hit.characters|length > 0 %}
                        <div class="d-flex gap-2 align-items-start mt-2">
                            {# mask/theater icon #}
                            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true">
                                <path fill="currentColor" d="M12 3C7 3 2 5 2 5v6c0 5 4 9 10 10c6-1 10-5 10-10V5s-5-2-10-2m-2 7a1 1 0 1 1 0-2a1 1 0 0 1 0 2m6 0a1 1 0 1 1 0-2a1 1 0 0 1 0 2m-7.5 3.5c1 .67 2.24 1 3.5 1s2.5-.33 3.5-1c.33-.22.5.14.5.5c0 1.38-1.79 2.5-4 2.5s-4-1.12-4-2.5c0-.36.17-.72.5-.5"/>
                            </svg>
                            <div class="flex-grow-1">
                                <div class="fw-semibold">Characters</div>
                                <div class="text-truncate">
                                    {% set charsToShow = hit.characters|slice(0,3) %}
                                    {% for i, ch in charsToShow %}
                                        {% set hrch = hit._highlightResult and hit._highlightResult.characters is defined ? hit._highlightResult.characters[i] : null %}
                                        {% if hrch and hrch.value is defined %}
                                            {{ hrch.value|raw }}{% if not loop.last %}, {% endif %}
                                        {% else %}
                                            {{ ch }}{% if not loop.last %}, {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                    {% if hit.characters|length > 3 %}
                                        <span class="text-body-secondary">+{{ hit.characters|length - 3 }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>

                <div class="d-flex flex-wrap gap-3 text-body-secondary small">
                    {% if hit.votes %}<span>{{ hit.votes|number_format(0, '.', ',') }} votes</span>{% endif %}
                    {% if hit.popularity %}<span>Popularity {{ hit.popularity|number_format(1, '.', ',') }}</span>{% endif %}
                    {% if hit.budget %}<span>${{ (hit.budget / 1000000)|number_format(0, '.', ',') }}M budget</span>{% endif %}
                </div>
            </div>

            <div class="card-footer d-flex justify-content-between align-items-center gap-2 flex-wrap">
                <div class="small text-body-secondary">ID: {{ hit.id }}</div>

                <button
                    {{ stimulus_action(globals._sc_modal, 'modal') }}
                    data-hit-id="{{ hit.id }}"
                    class="btn btn-sm btn-outline-primary d-inline-flex align-items-center gap-1">
                    {{ ux_icon('json')|raw }}
                    <span class="line-limit-1">{{ hit.id }}</span>
                </button>
            </div>

        </div>
    </div>
</div>
