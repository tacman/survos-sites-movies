{% set cfg = {
    pk:        _config.primaryKey | default('id'),
    maxLen:    (_config.maxLen is defined) ? _config.maxLen : 120,
    maxList:   (_config.maxList is defined) ? _config.maxList : 6,
    prettyJson: (_config.prettyJson is defined) ? _config.prettyJson : true
} %}

{% set pkVal = attribute(hit, cfg.pk) is defined ? attribute(hit, cfg.pk) : (hit.id ?? null) %}
{% set collapseId = 'hit-' ~ (pkVal ?? random()) ~ '-more' %}
{% set shownCount = 8 %}

{% set imageUrl = null %}
{% for k, v in hit %}
    {% if imageUrl is null and (v is not iterable) and (v is not same as(null)) %}
        {% set s = (v)|lower %}
        {% if ('http://' in s or 'https://' in s) and ('.jpg' in s or '.jpeg' in s) %}
            {% set imageUrl = v %}
        {% endif %}
    {% endif %}
{% endfor %}

<div class="card h-100 shadow-sm border-0">

    <div class="card-body p-3">
        {% if imageUrl %}
            <img
                src="{{ imageUrl }}"
                alt="{{ hit.identificationID|default('Image') }}"
                class="img-fluid d-block mx-auto rounded-top"
                loading="lazy" decoding="async"
                style="max-height:160px; width:auto; height:auto; max-width:100%;"
            >
        {% endif %}

        {% if hit.identificationModelYear ?? false %}
            <h5 class="card-title mb-2 text-wrap" style="white-space:normal; word-break:break-word;">
                {{ hit.identificationModelYear }}
            </h5>
        {% endif %}

        <div class="card-body p-3">
            {{ hit.engineInformationEngineType }} - {{ hit.engineInformationDriveline }}
        </div>

    </div>

    <div class="card-footer bg-transparent border-0 d-flex justify-content-between align-items-center flex-wrap gap-2">
        {% set pkVal = attribute(hit, _config.primaryKey|default('id')) %}
        <button
                {{ stimulus_action(globals._sc_modal, 'modal') }}
                data-hit-id="{{ pkVal }}"
                class="btn btn-sm btn-primary d-inline-flex align-items-center gap-1"
                title="View JSON details">
            {{ ux_icon('json')|raw }}
            <span class="ms-1">Details {{ pkVal }}</span>
        </button>

        {% if hit.url ?? false %}
            <a href="{{ hit.url }}" target="_blank" rel="noreferrer" class="btn btn-sm btn-outline-secondary">
                ðŸ”— Open
            </a>
        {% endif %}
    </div>
</div>